# Структура 
- Сервер.

   **database** содержит .txt файл с командами для создания базы данных.
   
   **thrift** содержит .thrift файл, необходимый для генерации классов.
   
   **src/resources** содержит конфиг для базы данных и для консольных логов.
   
   Папка **thrift** в src включает в себя сгенерированные через thrift.exe классы. Они описывают таблицы и поля БД, а также HandbookService имеет интерфейс Iface, который описывает CRUD операции над БД.
   
   Класс **HandbookHandler** реализует интерфейс HandbookService.Iface. Там полностью описано поведение при CRUD операциях (Sql команды через prepared statements). 
   
   Класс **Server** имеет метод Start, который запускает thrift сервер.
   
- Клиент.

   Для работы с приложением нужна библиотека javafx, поэтому я ее закинула в папку **lib**.
   
   Папка **thrift** в src включает в себя те же сгенерированные через thrift.exe классы.
   
   **Controller** выводит окно подключения к серверу (showConnectionDialog), а также выполняет инициализацию БД (вывод окна с таблицей) и т.д.
   
   **EditingCell** - редактирование отдельных ячеек (прямо в таблице). 
   
   **InsertDialog** - окно добавления данных в БД.
   
   **ProtocolPerformer** - интерфейс для реализации подключения(в зависимости от типа).
   
   **RpcProtocolPerformer** - реализует вышеописанный интерфейс и реализует RPC соединение (передает команды серверу и тд).
   
# Описание работы программы
Данные для БД были взяты [отсюда](https://ru.wikipedia.org/wiki/Jakarta_EE#Технологии).

Изначально мы пишем специальный **.thrift** файл, который описывает структуру нашей БД и CRUD операции. Подробное пояснение содержимого этого файла будет описано ниже. Далее с помощью команды 

`thrift.exe --gen java service.thrift`

генериуются java классы, которые будут использоваться и для клиента, и для сервера. Для сервера там есть интефейс, который был описан за счет thrift файла, и который реализован в классах приложения-сервера, а также описания структур, которые необходимы для хранения даных из БД. Для клиента есть класс Client , который в CRUD методах вызывает методы типа send/recv - для общения между клиентом и сервером.

Запуск сервера происходит классическим образом: создается сокет с определенным портом (тут задан в конфиге), а далее создается Thrift сервер (TThreadPoolServer) с аргументом в виде нашего сокета.

Далее запускается клиент, в окно вводится порт, к которому нужно подключиться, и в методе connect класса RpcProtocolPerformer проверяется правильность написанного порта и создается клиент через класс HandbookService.Client, где описаны методы для общения клиента и сервера.

Далее уже через интерфейс клиента выполняем CRUD операции над БД.

# Описание .thrift файла
1. **namespace**. 

`namespace java thrift`

Описывает язык, для которого генерируется файл (java) и package, в котором будет находится класс (thrift).

2. **struct**.

`struct JavaEETechnology {    
1: i32 id;
2: string name;   
3: UsedVersions versions;   
4: string description; 
}`

Описывает структуры, которые используются в программе. Например будет создан класс JavaEETecnology, в котором будет 4 поля (int, string, UsedVersions, string).

3. **service**

`service HandbookService`

Создается класс HandbookService, в котором есть интерфейс с методами, описанными внутри service, а также в котором есть класс Client, в котором те же методы организовывают общение клиента и сервера.

# Работа с интерфейсом клиента
В окне ввода порта по дефолту задан нужный, поэтому нужно просто нажать ОК.

При подключении клиента к серверу появится окно, в котором при правильном подключении должна быть заполненная данными таблица.

- Добавление данных: ctrl + A или Table -> Add.
- Удаление данных: нажать на необходимую строку и нажать Delete ИЛИ Table -> Remove ИЛИ ctrl + R. Для отображения изменений ctrl + S или Table -> Synchronize.
- Редактирование данных.

    Первый способ. Можно дважды кликнуть на нужную ячейку, изменить ее и нажать Enter. Тогда будут внесены изменения ТОЛЬКО этой ячейки в БД.

    Второй способ. Можно дважды кликнуть на нужную ячейку, изменить ее и нажать F1. Изменение будет зафиксировано, но не будет занесено в БД. Так можно отредактировать остальные необходимые ячейки и дальше нажать ctrl + U ИЛИ Table -> Update. 

    Для отображения изменений ctrl + S или Table -> Synchronize.
- Для отмены изменения ячейки после двойного клика по ней нужно нажать Esc.

# Запуск
Изначально необходимо в Tomcat/conf/server.xml добавить конфигурацию БД.

- Для сервера:

    Все файлы уже сгенерированы и раскиданы по папкам, поэтому для сервера достаточно запустить приложение.

- Для клиента:

    Для клиента нужно добавить в modules библиотеку javafx, которая находится в папке lib, а в параметры запуска в VM Options нужно добавить 
    
   `--module-path "lib\javafx-sdk-11.0.2\lib" --add-modules=javafx.controls,javafx.fxml`
